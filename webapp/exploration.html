<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>NBS Dashboard</title>

    <link rel="stylesheet" href="./css/styles.css" />
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/topojson-client@3"></script>
  </head>

  <body>
    <header class="header">
      <div class="headerInner">
        <h1>NBS Dashboard</h1>
      </div>
    </header>

    <div id="navMount"></div>

    <main class="grid">
      <div id="filtersMount"></div>

      <div id="mapMount"></div>

      <div id="resultsMount" class="card full"></div>
    </main>

    <script>
      async function injectHtml(selector, url) {
        const mount = document.querySelector(selector);
        if (!mount) throw new Error(`Mount not found: ${selector}`);

        const res = await fetch(url, { cache: "no-cache" });
        if (!res.ok) throw new Error(`Failed to load ${url} (${res.status})`);

        mount.innerHTML = await res.text();
      }

      async function boot() {
        await injectHtml("#mapSimilarityBandsMount", "./components/map_similarity_bands.html");
        await injectHtml("#navMount", "./components/nav.html");
        await injectHtml("#filtersMount", "./components/filters.html");
        await injectHtml("#mapMount", "./components/map_filtered_cities.html");
        await injectHtml("#resultsMount", "./components/results.html");

        const script = document.createElement("script");
        script.src = "./js/main.js";
        document.body.appendChild(script);
      }

      boot().catch((err) => {
        console.error(err);
        document.body.insertAdjacentHTML(
          "beforeend",
          `<pre style="padding:12px; border:1px solid #ccc; white-space:pre-wrap;">
Failed to boot app:
${err.message}
</pre>`
        );
      });
    </script>
  </body>
</html>
